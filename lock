--// Camlock + UI Smoothness & Prediction (Fix UI)
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local camlockOn, holdingRMB, allowSlot = false, false, false
local target, marker = nil, nil

-- Settings
local Smoothness = 0.15
local Prediction = 0.12

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CamlockUI"
ScreenGui.ResetOnSpawn = false
if syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = game.CoreGui
else
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
end

local Main = Instance.new("Frame")
Main.Size = UDim2.new(0, 220, 0, 120)
Main.Position = UDim2.new(0.35, 0, 0.65, 0)
Main.BackgroundColor3 = Color3.fromRGB(30,30,30)
Main.BorderColor3 = Color3.fromRGB(200,50,50)
Main.Active = true
Main.Draggable = true
Main.Parent = ScreenGui

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 20)
Title.BackgroundTransparency = 1
Title.Text = "Camlock Settings"
Title.TextColor3 = Color3.new(1,1,1)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 16
Title.Parent = Main

-- tạo slider
local function makeSlider(name, min, max, default, order, callback)
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(1,-20,0,30)
    Frame.Position = UDim2.new(0,10,0,25 + (order*35))
    Frame.BackgroundTransparency = 1
    Frame.Parent = Main

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(0.4,0,1,0)
    Label.BackgroundTransparency = 1
    Label.Text = name..": "..default
    Label.TextColor3 = Color3.new(1,1,1)
    Label.Font = Enum.Font.SourceSans
    Label.TextSize = 14
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Frame

    local Slider = Instance.new("TextButton")
    Slider.Size = UDim2.new(0.6,0,0,6)
    Slider.Position = UDim2.new(0.4,0,0.5,-3)
    Slider.BackgroundColor3 = Color3.fromRGB(60,60,60)
    Slider.Text = ""
    Slider.AutoButtonColor = false
    Slider.Parent = Frame

    local Fill = Instance.new("Frame")
    Fill.Size = UDim2.new((default-min)/(max-min),0,1,0)
    Fill.BackgroundColor3 = Color3.fromRGB(200,50,50)
    Fill.BorderSizePixel = 0
    Fill.Parent = Slider

    local dragging = false
    Slider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end
    end)
    UIS.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)
    RunService.RenderStepped:Connect(function()
        if dragging then
            local mouse = UIS:GetMouseLocation().X
            local pos = math.clamp((mouse - Slider.AbsolutePosition.X)/Slider.AbsoluteSize.X,0,1)
            Fill.Size = UDim2.new(pos,0,1,0)
            local value = math.floor((min + (max-min)*pos)*100)/100
            Label.Text = name..": "..value
            callback(value)
        end
    end)
end

-- tạo sliders
makeSlider("Smoothness",0,1,Smoothness,0,function(v) Smoothness=v end)
makeSlider("Prediction",0,1,Prediction,1,function(v) Prediction=v end)

-- Toggle UI bằng T
UIS.InputBegan:Connect(function(input,gpe)
    if not gpe and input.KeyCode == Enum.KeyCode.T then
        Main.Visible = not Main.Visible
    end
end)

-- Valid target
local function valid(plr)
    if not plr or plr == LocalPlayer then return false end
    local char = plr.Character
    if not char then return false end
    local hum = char:FindFirstChildOfClass("Humanoid")
    local head = char:FindFirstChild("Head")
    return hum and hum.Health > 0 and head ~= nil
end

-- Marker
local function addMarker(head)
    if marker then marker:Destroy() end
    marker = Instance.new("BillboardGui")
    marker.Size = UDim2.new(0,6,0,6)
    marker.AlwaysOnTop = true
    marker.Adornee = head
    local dot = Instance.new("Frame", marker)
    dot.Size = UDim2.new(1,0,1,0)
    dot.BackgroundColor3 = Color3.new(1,0,0)
    dot.BorderSizePixel = 0
    dot.AnchorPoint = Vector2.new(0.5,0.5)
    dot.Position = UDim2.new(0.5,0,0.5,0)
    marker.Parent = head
end
local function removeMarker() if marker then marker:Destroy() marker=nil end end

-- Closest player
local function closestToMouse()
    local best, bestDist = nil, math.huge
    local mousePos = UIS:GetMouseLocation() - Vector2.new(0,36)
    for _, plr in ipairs(Players:GetPlayers()) do
        if valid(plr) then
            local head = plr.Character.Head
            local vp, onScreen = Camera:WorldToViewportPoint(head.Position)
            if onScreen then
                local d = (Vector2.new(vp.X,vp.Y) - mousePos).Magnitude
                if d < bestDist then
                    bestDist = d
                    best = plr
                end
            end
        end
    end
    return best
end

-- tool check
local function holdingTool()
    return LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool") ~= nil
end

-- Input
UIS.InputBegan:Connect(function(input,gpe)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then holdingRMB = true return end
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.Q then
        if camlockOn then camlockOn=false target=nil removeMarker()
        else target=closestToMouse() if target then camlockOn=true addMarker(target.Character.Head) end end
    elseif input.KeyCode == Enum.KeyCode.One or input.KeyCode == Enum.KeyCode.Two or input.KeyCode == Enum.KeyCode.Three then
        allowSlot = true
    elseif input.KeyCode == Enum.KeyCode.Four or input.KeyCode == Enum.KeyCode.Five or input.KeyCode == Enum.KeyCode.Six or input.KeyCode == Enum.KeyCode.Seven or input.KeyCode == Enum.KeyCode.Eight or input.KeyCode == Enum.KeyCode.Nine or input.KeyCode == Enum.KeyCode.Zero then
        allowSlot = false
    end
end)
UIS.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton2 then holdingRMB=false end end)

-- Loop
RunService.RenderStepped:Connect(function()
    if target and not valid(target) then target=nil camlockOn=false removeMarker() return end
    if camlockOn and holdingRMB and allowSlot and holdingTool() and target then
        local head = target.Character.Head
        local root = target.Character:FindFirstChild("HumanoidRootPart")
        local predicted = head.Position
        if root then predicted = predicted + (root.Velocity * Prediction) end
        local newCF = CFrame.new(Camera.CFrame.Position, predicted)
        Camera.CFrame = Camera.CFrame:Lerp(newCF, Smoothness)
    end
end)
